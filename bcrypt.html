<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bcrypt Algorithm Visualizer</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          #667eea 0%,
          #764ba2 50%,
          #f093fb 100%
        );
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 30px;
        font-size: 2.5em;
        background: linear-gradient(45deg, #667eea, #764ba2, #f093fb);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .input-section {
        margin-bottom: 30px;
      }

      .input-row {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
        align-items: center;
      }

      input[type="text"],
      input[type="password"] {
        flex: 1;
        padding: 15px;
        border: 2px solid #ddd;
        border-radius: 10px;
        font-size: 16px;
        transition: border-color 0.3s;
      }

      input[type="text"]:focus,
      input[type="password"]:focus {
        outline: none;
        border-color: #667eea;
      }

      input[type="range"] {
        width: 200px;
        margin: 0 15px;
      }

      .cost-display {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: bold;
        min-width: 100px;
        text-align: center;
      }

      button {
        padding: 15px 30px;
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        transition: transform 0.2s;
      }

      button:hover {
        transform: translateY(-2px);
      }

      .step-container {
        margin-bottom: 30px;
      }

      .step {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        border-left: 5px solid #667eea;
        transition: all 0.3s;
      }

      .step.active {
        background: linear-gradient(135deg, #667eea20, #764ba220);
        transform: scale(1.02);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      }

      .step-title {
        font-size: 1.4em;
        font-weight: bold;
        color: #333;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .step-number {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
      }

      .salt-display {
        font-family: "Courier New", monospace;
        background: linear-gradient(135deg, #2d3748, #4a5568);
        color: #68d391;
        padding: 15px;
        border-radius: 10px;
        margin: 10px 0;
        overflow-x: auto;
        font-size: 14px;
        line-height: 1.5;
      }

      .blowfish-visual {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 15px 0;
      }

      .blowfish-component {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
      }

      .blowfish-component.active {
        animation: pulse 1s ease-in-out;
        background: linear-gradient(135deg, #f093fb, #f5576c);
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .iteration-visual {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 8px;
        margin: 15px 0;
        padding: 20px;
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        border-radius: 10px;
      }

      .iteration-block {
        background: #e2e8f0;
        padding: 10px;
        border-radius: 5px;
        text-align: center;
        font-family: "Courier New", monospace;
        font-size: 11px;
        transition: all 0.3s;
        min-height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }

      .iteration-block.active {
        background: linear-gradient(45deg, #f093fb, #f5576c);
        color: white;
        transform: scale(1.1);
      }

      .iteration-block.completed {
        background: linear-gradient(45deg, #48dbfb, #0abde3);
        color: white;
      }

      .final-hash {
        background: linear-gradient(135deg, #2d3748, #4a5568);
        color: #68d391;
        padding: 20px;
        border-radius: 15px;
        font-family: "Courier New", monospace;
        word-break: break-all;
        text-align: center;
        font-size: 16px;
        letter-spacing: 1px;
        margin-top: 20px;
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: #e2e8f0;
        border-radius: 4px;
        margin: 20px 0;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
        border-radius: 4px;
        transition: width 0.5s ease;
        width: 0%;
      }

      .controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin: 20px 0;
      }

      .info-box {
        background: linear-gradient(135deg, #e6f3ff, #cce7ff);
        border: 1px solid #667eea;
        border-radius: 10px;
        padding: 15px;
        margin: 15px 0;
      }

      .algorithm-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .info-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        border-top: 4px solid #667eea;
      }

      .info-card h3 {
        color: #333;
        margin-bottom: 10px;
      }

      .security-highlight {
        background: linear-gradient(135deg, #d4edda, #c3e6cb);
        border: 2px solid #28a745;
        border-radius: 10px;
        padding: 15px;
        margin: 15px 0;
        color: #155724;
      }

      .timing-display {
        background: linear-gradient(135deg, #fff3cd, #ffeaa7);
        border: 1px solid #feca57;
        border-radius: 10px;
        padding: 15px;
        margin: 15px 0;
        text-align: center;
        font-size: 18px;
        font-weight: bold;
      }

      .cost-explanation {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 10px;
        margin: 15px 0;
      }

      .cost-item {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 10px;
        border-radius: 8px;
        text-align: center;
        font-size: 12px;
      }

      .bcrypt-format {
        font-family: "Courier New", monospace;
        background: #2d3748;
        color: #68d391;
        padding: 15px;
        border-radius: 10px;
        margin: 10px 0;
        word-break: break-all;
        line-height: 1.6;
      }

      .format-part {
        display: inline-block;
        margin: 2px;
        padding: 2px 6px;
        border-radius: 4px;
      }

      .format-version {
        background: #ff6b6b;
        color: white;
      }
      .format-cost {
        background: #feca57;
        color: white;
      }
      .format-salt {
        background: #48dbfb;
        color: white;
      }
      .format-hash {
        background: #ff9ff3;
        color: white;
      }

      .blowfish-detail {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        border-radius: 10px;
        padding: 20px;
        margin: 15px 0;
      }

      .blowfish-rounds {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        gap: 5px;
        margin: 10px 0;
      }

      .round-indicator {
        background: #e2e8f0;
        padding: 8px;
        border-radius: 4px;
        text-align: center;
        font-size: 10px;
        transition: all 0.3s;
      }

      .round-indicator.active {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîê Bcrypt Algorithm Visualizer</h1>

      <div class="security-highlight">
        ‚úÖ <strong>Security Best Practice:</strong> Bcrypt is designed
        specifically for secure password hashing with adaptive cost, built-in
        salt generation, and resistance to timing attacks.
      </div>

      <div class="algorithm-info">
        <div class="info-card">
          <h3>üéØ What is Bcrypt?</h3>
          <p>
            Bcrypt is a password hashing function based on the Blowfish cipher.
            It incorporates a salt and a cost parameter to defend against
            rainbow table and brute-force attacks.
          </p>
        </div>
        <div class="info-card">
          <h3>üõ°Ô∏è Security Features</h3>
          <ul>
            <li>Built-in salt generation</li>
            <li>Adaptive cost (work factor)</li>
            <li>Resistant to timing attacks</li>
            <li>Slow by design</li>
          </ul>
        </div>
        <div class="info-card">
          <h3>‚öôÔ∏è Algorithm Steps</h3>
          <ol>
            <li>Generate random salt</li>
            <li>Derive key from password</li>
            <li>Initialize Blowfish state</li>
            <li>Expand key with salt & password</li>
            <li>Iterative encryption (2^cost times)</li>
          </ol>
        </div>
      </div>

      <div class="input-section">
        <div class="input-row">
          <input
            type="password"
            id="passwordInput"
            placeholder="Enter password to hash..."
            value="mypassword123"
          />
          <button onclick="startVisualization()">üîí Hash with Bcrypt</button>
        </div>
        <div class="input-row">
          <label>Cost Factor:</label>
          <input
            type="range"
            id="costRange"
            min="4"
            max="12"
            value="10"
            onchange="updateCostDisplay()"
          />
          <div class="cost-display" id="costDisplay">10 (1024 rounds)</div>
        </div>
      </div>

      <div class="progress-bar">
        <div class="progress-fill" id="progressBar"></div>
      </div>

      <div class="controls">
        <button onclick="pauseVisualization()">‚è∏Ô∏è Pause</button>
        <button onclick="resumeVisualization()">‚ñ∂Ô∏è Resume</button>
        <button onclick="resetVisualization()">üîÑ Reset</button>
      </div>

      <div class="step-container" id="stepContainer">
        <!-- Steps will be dynamically generated -->
      </div>

      <div class="final-hash" id="finalHash" style="display: none">
        <!-- Final hash will appear here -->
      </div>
    </div>

    <script>
      let currentStep = 0;
      let isPaused = false;
      let visualizationTimeout;
      let password = "";
      let cost = 10;
      let steps = [];
      let generatedSalt = "";
      let startTime = 0;

      // Simplified Bcrypt implementation for visualization
      function generateSalt() {
        const chars =
          "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789./";
        let salt = "";
        for (let i = 0; i < 22; i++) {
          salt += chars[Math.floor(Math.random() * chars.length)];
        }
        return salt;
      }

      function base64Encode(str) {
        return btoa(str)
          .replace(/\+/g, ".")
          .replace(/\//g, "/")
          .replace(/=/g, "");
      }

      // Simplified Bcrypt hash generation (for demonstration purposes)
      function generateBcryptHash(password, salt, cost) {
        // This is a simplified version for visualization
        // Real bcrypt uses Blowfish cipher with key expansion
        let hash = password + salt;

        // Simulate multiple rounds
        for (let i = 0; i < Math.pow(2, cost); i++) {
          // Simplified hash mixing (not actual bcrypt algorithm)
          hash = btoa(hash + i.toString()).slice(0, 31);
        }

        return hash;
      }

      function formatBcryptOutput(cost, salt, hash) {
        const version = "2b";
        const costStr = cost.toString().padStart(2, "0");
        return `$${version}$${costStr}$${salt}${hash}`;
      }

      function updateCostDisplay() {
        cost = parseInt(document.getElementById("costRange").value);
        const rounds = Math.pow(2, cost);
        document.getElementById(
          "costDisplay"
        ).textContent = `${cost} (${rounds.toLocaleString()} rounds)`;
      }

      function createSteps(password, cost) {
        steps = [];
        generatedSalt = generateSalt();

        steps.push({
          title: "Step 1: Input Analysis",
          content: `Password: "${password}" (${password.length} characters)<br>
                         Cost Factor: ${cost} (${Math.pow(
            2,
            cost
          ).toLocaleString()} iterations)<br>
                         Higher cost = more secure but slower computation`,
          passwordAnalysis: true,
        });

        steps.push({
          title: "Step 2: Salt Generation",
          content: `Generate a random 128-bit (22-character) salt using secure random number generator.<br>
                         Salt prevents rainbow table attacks and ensures unique hashes for identical passwords.`,
          salt: generatedSalt,
          saltGeneration: true,
        });

        steps.push({
          title: "Step 3: Blowfish Initialization",
          content: `Initialize Blowfish cipher state with:<br>
                         ‚Ä¢ 18 P-array entries (subkeys)<br>
                         ‚Ä¢ 4 S-boxes with 256 entries each<br>
                         ‚Ä¢ Total: 4168 bytes of state`,
          blowfishInit: true,
        });

        steps.push({
          title: "Step 4: Key Expansion",
          content: `Expand the key using EksBlowfish algorithm:<br>
                         1. XOR password with P-array<br>
                         2. Encrypt salt with current state<br>
                         3. Update P-array and S-boxes with result`,
          keyExpansion: true,
        });

        steps.push({
          title: "Step 5: Iterative Encryption",
          content: `Perform ${Math.pow(
            2,
            cost
          ).toLocaleString()} rounds of expensive key setup:<br>
                         Each round re-derives the key from password and salt<br>
                         This adaptive work factor makes brute force attacks impractical`,
          iterations: Math.pow(2, cost),
          iterativeEncryption: true,
        });

        steps.push({
          title: "Step 6: Final Encryption",
          content: `Encrypt the magic string "OrpheanBeholderScryDoubt" 64 times<br>
                         This produces the final 192-bit hash value`,
          finalEncryption: true,
        });

        steps.push({
          title: "Step 7: Format Output",
          content: `Format the result as a standard bcrypt hash string:<br>
                         $version$cost$salt+hash`,
          formatOutput: true,
          finalResult: true,
        });
      }

      function renderStep(stepIndex) {
        const step = steps[stepIndex];
        const stepContainer = document.getElementById("stepContainer");

        let html = `<div class="step active">
                <div class="step-title">
                    <div class="step-number">${stepIndex + 1}</div>
                    ${step.title}
                </div>`;

        if (step.content) {
          html += `<div class="info-box">${step.content}</div>`;
        }

        if (step.passwordAnalysis) {
          html += `<div class="cost-explanation">
                    <div class="cost-item">Cost 4<br>16 rounds<br>~1ms</div>
                    <div class="cost-item">Cost 8<br>256 rounds<br>~16ms</div>
                    <div class="cost-item">Cost 10<br>1024 rounds<br>~65ms</div>
                    <div class="cost-item">Cost 12<br>4096 rounds<br>~260ms</div>
                </div>`;
        }

        if (step.saltGeneration) {
          html += `<div class="salt-display">
                    Generated Salt: ${step.salt}
                    <div style="margin-top: 10px; font-size: 12px; opacity: 0.8;">
                        ‚Ä¢ 128 bits of randomness<br>
                        ‚Ä¢ Base64-encoded (modified)<br>
                        ‚Ä¢ Unique for each hash
                    </div>
                </div>`;
        }

        if (step.blowfishInit) {
          html += `<div class="blowfish-visual">
                    <div class="blowfish-component active">
                        <strong>P-Array</strong><br>
                        18 √ó 32-bit<br>
                        Subkeys
                    </div>
                    <div class="blowfish-component active">
                        <strong>S-Box 1</strong><br>
                        256 √ó 32-bit<br>
                        Substitutions
                    </div>
                    <div class="blowfish-component active">
                        <strong>S-Box 2</strong><br>
                        256 √ó 32-bit<br>
                        Substitutions
                    </div>
                    <div class="blowfish-component active">
                        <strong>S-Box 3</strong><br>
                        256 √ó 32-bit<br>
                        Substitutions
                    </div>
                    <div class="blowfish-component active">
                        <strong>S-Box 4</strong><br>
                        256 √ó 32-bit<br>
                        Substitutions
                    </div>
                </div>`;
        }

        if (step.keyExpansion) {
          html += `<div class="blowfish-detail">
                    <h4>EksBlowfish Key Expansion Process:</h4>
                    <div class="blowfish-rounds">`;
          for (let i = 0; i < 16; i++) {
            html += `<div class="round-indicator ${
              i < 8 ? "active" : ""
            }">Round ${i + 1}</div>`;
          }
          html += `</div>
                    <p>Each round modifies the cipher state based on password and salt</p>
                </div>`;
        }

        if (step.iterativeEncryption) {
          const numBlocks = Math.min(32, Math.ceil(step.iterations / 64));
          html += `<div class="iteration-visual">`;
          for (let i = 0; i < numBlocks; i++) {
            const blockIterations = Math.min(64, step.iterations - i * 64);
            const status = i < 8 ? "active" : i < 16 ? "completed" : "";
            html += `<div class="iteration-block ${status}">
                        <div>Block ${i + 1}</div>
                        <div>${blockIterations} iter</div>
                    </div>`;
          }
          if (step.iterations > 2048) {
            html += `<div class="iteration-block">...</div>`;
          }
          html += "</div>";
        }

        if (step.formatOutput) {
          const hash = generateBcryptHash(password, generatedSalt, cost);
          const fullHash = formatBcryptOutput(cost, generatedSalt, hash);

          html += `<div class="bcrypt-format">
                    <span class="format-part format-version">$2b</span><span class="format-part format-cost">$${cost
                      .toString()
                      .padStart(
                        2,
                        "0"
                      )}</span><span class="format-part format-salt">$${generatedSalt}</span><span class="format-part format-hash">${hash}</span>
                </div>
                <div style="margin-top: 15px;">
                    <strong>Format Breakdown:</strong><br>
                    <span class="format-part format-version" style="display: inline;">$2b</span> = Bcrypt version<br>
                    <span class="format-part format-cost" style="display: inline;">$${cost
                      .toString()
                      .padStart(2, "0")}</span> = Cost factor<br>
                    <span class="format-part format-salt" style="display: inline;">Salt</span> = 22-char salt<br>
                    <span class="format-part format-hash" style="display: inline;">Hash</span> = 31-char hash
                </div>`;
        }

        html += "</div>";
        stepContainer.innerHTML = html;
      }

      function updateProgress() {
        const progress = ((currentStep + 1) / steps.length) * 100;
        document.getElementById("progressBar").style.width = `${progress}%`;
      }

      function nextStep() {
        if (isPaused) return;

        if (currentStep < steps.length) {
          renderStep(currentStep);
          updateProgress();
          currentStep++;

          if (currentStep < steps.length) {
            // Longer delay for iterative encryption step
            const delay = currentStep === 5 ? 3000 : 2000;
            visualizationTimeout = setTimeout(nextStep, delay);
          } else {
            showFinalHash();
          }
        }
      }

      function showFinalHash() {
        const endTime = Date.now();
        const duration = endTime - startTime;

        const hash = generateBcryptHash(password, generatedSalt, cost);
        const fullHash = formatBcryptOutput(cost, generatedSalt, hash);

        const finalHashDiv = document.getElementById("finalHash");
        finalHashDiv.innerHTML = `
                <h3>üéâ Bcrypt Hash Complete!</h3>
                <div style="margin-top: 15px; font-size: 14px; word-break: break-all;">
                    ${fullHash}
                </div>
                <div class="timing-display" style="margin-top: 15px;">
                    ‚è±Ô∏è Computation Time: ${duration}ms
                </div>
                <div style="margin-top: 10px; font-size: 12px; opacity: 0.8;">
                    Cost ${cost}: ${Math.pow(
          2,
          cost
        ).toLocaleString()} iterations completed
                </div>
            `;
        finalHashDiv.style.display = "block";
      }

      function startVisualization() {
        password =
          document.getElementById("passwordInput").value || "mypassword123";
        cost = parseInt(document.getElementById("costRange").value);
        startTime = Date.now();

        currentStep = 0;
        isPaused = false;

        document.getElementById("stepContainer").innerHTML = "";
        document.getElementById("finalHash").style.display = "none";
        document.getElementById("progressBar").style.width = "0%";

        createSteps(password, cost);
        nextStep();
      }

      function pauseVisualization() {
        isPaused = true;
        if (visualizationTimeout) {
          clearTimeout(visualizationTimeout);
        }
      }

      function resumeVisualization() {
        if (isPaused && currentStep < steps.length) {
          isPaused = false;
          nextStep();
        }
      }

      function resetVisualization() {
        isPaused = false;
        currentStep = 0;
        if (visualizationTimeout) {
          clearTimeout(visualizationTimeout);
        }
        document.getElementById("stepContainer").innerHTML = "";
        document.getElementById("finalHash").style.display = "none";
        document.getElementById("progressBar").style.width = "0%";
      }

      // Initialize
      window.onload = function () {
        updateCostDisplay();
        startVisualization();
      };
    </script>
  </body>
</html>
