<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>HotStuff Consensus | AlgoViz Hub</title>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;500;700&family=Roboto:wght@300;400;500;700&display=swap"
            rel="stylesheet"
        />
        <style>
            :root {
                --primary: #0f172a;
                --secondary: #1e293b;
                --accent: #6366f1;
                --accent-light: #818cf8;
                --accent-glow: rgba(99, 102, 241, 0.2);
                --text: #e2e8f0;
                --text-secondary: #94a3b8;
                --card-bg: rgba(30, 41, 59, 0.7);
                --success: #10b981;
                --warning: #f59e0b;
                --danger: #ef4444;
                --transition: all 0.3s ease;
                --radius: 12px;
                --shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                --glow: 0 0 15px var(--accent-glow);
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                background: linear-gradient(
                    135deg,
                    var(--primary),
                    var(--secondary)
                );
                color: var(--text);
                font-family: "Roboto", sans-serif;
                line-height: 1.6;
                min-height: 100vh;
                padding: 0;
                position: relative;
                overflow-x: hidden;
            }

            body::before {
                content: "";
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background:
                    radial-gradient(
                        circle at 10% 20%,
                        rgba(99, 102, 241, 0.1) 0%,
                        transparent 20%
                    ),
                    radial-gradient(
                        circle at 90% 80%,
                        rgba(129, 140, 248, 0.1) 0%,
                        transparent 20%
                    );
                z-index: -1;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 20px;
            }

            /* Header Styles */
            header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 20px 0;
                position: relative;
                border-bottom: 1px solid rgba(148, 163, 184, 0.2);
            }

            .logo {
                display: flex;
                align-items: center;
                gap: 15px;
            }

            .logo-icon {
                width: 50px;
                height: 50px;
                background: var(--accent);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: var(--glow);
            }

            .logo-icon i {
                font-size: 24px;
                color: white;
            }

            .logo-text h1 {
                font-family: "Roboto Mono", monospace;
                font-weight: 700;
                font-size: 28px;
                background: linear-gradient(
                    to right,
                    var(--accent-light),
                    var(--accent)
                );
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            }

            .logo-text p {
                font-size: 14px;
                color: var(--text-secondary);
                letter-spacing: 1.5px;
            }

            .breadcrumb {
                font-size: 14px;
                color: var(--text-secondary);
                margin-top: 10px;
            }

            .breadcrumb a {
                color: var(--accent-light);
                text-decoration: none;
                transition: var(--transition);
            }

            .breadcrumb a:hover {
                text-decoration: underline;
            }

            /* Algorithm Header */
            .algorithm-header {
                margin: 40px 0;
                text-align: center;
                padding: 20px;
                background: var(--card-bg);
                border-radius: var(--radius);
                border: 1px solid rgba(148, 163, 184, 0.1);
                backdrop-filter: blur(10px);
                position: relative;
                overflow: hidden;
            }

            .algorithm-header::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 4px;
                background: linear-gradient(
                    to right,
                    var(--accent),
                    var(--accent-light)
                );
            }

            .algorithm-header h1 {
                font-size: 42px;
                margin-bottom: 15px;
                background: linear-gradient(
                    to right,
                    var(--accent-light),
                    var(--accent)
                );
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                font-weight: 800;
            }

            .algorithm-header .category {
                font-size: 18px;
                color: var(--accent-light);
                margin-bottom: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
            }

            .complexity-badge {
                display: inline-block;
                background: rgba(129, 140, 248, 0.2);
                color: var(--accent-light);
                padding: 6px 15px;
                border-radius: 20px;
                font-size: 16px;
                font-weight: 600;
                font-family: "Roboto Mono", monospace;
                margin-top: 15px;
            }

            /* Main Content Layout */
            .main-content {
                display: grid;
                grid-template-columns: 1fr 350px;
                gap: 30px;
                margin-bottom: 40px;
            }

            @media (max-width: 900px) {
                .main-content {
                    grid-template-columns: 1fr;
                }
            }

            /* Algorithm Detail Sections */
            .section {
                background: var(--card-bg);
                border-radius: var(--radius);
                box-shadow: var(--shadow);
                padding: 30px;
                margin-bottom: 30px;
                border: 1px solid rgba(148, 163, 184, 0.1);
                backdrop-filter: blur(10px);
                position: relative;
                overflow: hidden;
            }

            .section::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 4px;
                background: linear-gradient(
                    to right,
                    var(--accent),
                    var(--accent-light)
                );
            }

            .section h2 {
                font-size: 26px;
                margin-bottom: 20px;
                color: var(--accent-light);
                display: flex;
                align-items: center;
                gap: 12px;
            }

            .section h2 i {
                color: var(--accent);
                width: 36px;
                height: 36px;
                background: rgba(99, 102, 241, 0.2);
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .section p {
                color: var(--text-secondary);
                font-size: 17px;
                line-height: 1.8;
                margin-bottom: 20px;
            }

            .key-points {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 20px;
                margin: 25px 0;
            }

            .point-card {
                background: rgba(15, 23, 42, 0.5);
                border-radius: var(--radius);
                padding: 20px;
                border: 1px solid rgba(148, 163, 184, 0.1);
            }

            .point-card h3 {
                color: var(--accent-light);
                margin-bottom: 12px;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .point-card h3 i {
                color: var(--accent);
            }

            .point-card p {
                margin-bottom: 0;
                font-size: 15px;
            }

            /* Visualization Console */
            .visualization-console {
                background: rgba(15, 23, 42, 0.8);
                border-radius: var(--radius);
                padding: 25px;
                margin: 30px 0;
                border: 1px solid rgba(99, 102, 241, 0.3);
                box-shadow: var(--glow);
            }

            .console-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
            }

            .console-header h3 {
                color: var(--accent-light);
                font-size: 20px;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .console-controls {
                display: flex;
                gap: 10px;
            }

            .console-btn {
                background: var(--accent);
                color: white;
                border: none;
                padding: 8px 15px;
                border-radius: 5px;
                cursor: pointer;
                font-family: "Roboto Mono", monospace;
                transition: var(--transition);
            }

            .console-btn:hover {
                background: var(--accent-light);
            }

            .console-btn.secondary {
                background: rgba(148, 163, 184, 0.2);
            }

            .visualization-area {
                height: 300px;
                background: rgba(0, 0, 0, 0.3);
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                position: relative;
                overflow: hidden;
            }

            .visualization-area::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.1);
                z-index: 0;
            }

            .console-input {
                display: flex;
                gap: 10px;
                margin-top: 20px;
            }

            .console-input input {
                flex: 1;
                padding: 12px 15px;
                background: rgba(0, 0, 0, 0.3);
                border: 1px solid rgba(148, 163, 184, 0.2);
                border-radius: 5px;
                color: var(--text);
                font-family: "Roboto Mono", monospace;
            }

            .console-input input:focus {
                outline: none;
                border-color: var(--accent);
            }

            /* Algorithm Properties */
            .properties-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 20px;
                margin-top: 20px;
            }

            .property-card {
                background: rgba(15, 23, 42, 0.5);
                border-radius: var(--radius);
                padding: 20px;
                border: 1px solid rgba(148, 163, 184, 0.1);
                text-align: center;
            }

            .property-card h4 {
                color: var(--text-secondary);
                font-size: 14px;
                margin-bottom: 8px;
                font-weight: 400;
            }

            .property-card .value {
                font-size: 20px;
                font-weight: 700;
                color: var(--accent-light);
                font-family: "Roboto Mono", monospace;
            }

            /* Footer */
            footer {
                text-align: center;
                padding: 40px 0 30px;
                color: var(--text-secondary);
                font-size: 14px;
                border-top: 1px solid rgba(148, 163, 184, 0.1);
                margin-top: 40px;
            }

            footer p {
                margin: 10px 0;
            }

            .footer-links {
                display: flex;
                justify-content: center;
                gap: 25px;
                margin-top: 15px;
                flex-wrap: wrap;
                margin-bottom: 20px;
            }

            .footer-links a {
                color: var(--accent-light);
                text-decoration: none;
                transition: var(--transition);
            }

            .footer-links a:hover {
                color: var(--accent);
            }

            /* Animations */
            @keyframes float {
                0% {
                    transform: translateY(0px);
                }
                50% {
                    transform: translateY(-10px);
                }
                100% {
                    transform: translateY(0px);
                }
            }

            .floating {
                animation: float 6s ease-in-out infinite;
            }

            /* Responsive Design */
            @media (max-width: 768px) {
                header {
                    flex-direction: column;
                    gap: 25px;
                    text-align: center;
                }

                .algorithm-header h1 {
                    font-size: 32px;
                }

                .key-points {
                    grid-template-columns: 1fr;
                }
            }

            /* Code Block Styling */
            .code-block {
                background: #0d1117;
                border-radius: 8px;
                padding: 20px;
                margin: 25px 0;
                overflow-x: auto;
                font-family: "Roboto Mono", monospace;
                font-size: 15px;
                border: 1px solid rgba(99, 102, 241, 0.3);
            }

            .code-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
                color: var(--text-secondary);
            }

            .copy-btn {
                background: rgba(99, 102, 241, 0.2);
                color: var(--accent-light);
                border: none;
                padding: 5px 10px;
                border-radius: 5px;
                cursor: pointer;
                font-family: "Roboto Mono", monospace;
                transition: var(--transition);
            }

            .copy-btn:hover {
                background: rgba(99, 102, 241, 0.3);
            }

            .code-block pre {
                margin: 0;
            }

            .code-block code {
                color: #c9d1d9;
                line-height: 1.5;
            }

            .keyword {
                color: #ff7b72;
            }
            .function {
                color: #d2a8ff;
            }
            .comment {
                color: #8b949e;
            }
            .string {
                color: #a5d6ff;
            }
            .number {
                color: #79c0ff;
            }

            /* HotStuff Visualization Styles */
            .cluster {
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100%;
                width: 100%;
                position: relative;
            }

            .node {
                width: 60px;
                height: 60px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                position: absolute;
                background: var(--secondary);
                border: 2px solid var(--accent);
                box-shadow: var(--glow);
                color: white;
                font-weight: bold;
                font-family: "Roboto Mono", monospace;
                z-index: 2;
                transition: all 0.5s ease;
            }

            .node.leader {
                background: var(--accent);
                border-color: var(--accent-light);
                box-shadow: 0 0 15px rgba(129, 140, 248, 0.5);
                transform: scale(1.1);
            }

            .node.client {
                background: var(--success);
                border-color: #34d399;
            }

            .node.byzantine {
                background: var(--danger);
                border-color: #f87171;
                animation: pulse 2s infinite;
            }

            @keyframes pulse {
                0% {
                    box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
                }
                70% {
                    box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
                }
                100% {
                    box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
                }
            }

            .message {
                position: absolute;
                background: rgba(129, 140, 248, 0.8);
                color: white;
                padding: 5px 10px;
                border-radius: 20px;
                font-size: 12px;
                font-family: "Roboto Mono", monospace;
                z-index: 1;
                opacity: 0;
                transition: opacity 0.3s ease;
            }

            .message.visible {
                opacity: 1;
            }

            .status-panel {
                position: absolute;
                bottom: 10px;
                left: 10px;
                right: 10px;
                background: rgba(15, 23, 42, 0.7);
                border-radius: 8px;
                padding: 10px;
                font-size: 14px;
                font-family: "Roboto Mono", monospace;
                text-align: center;
                color: var(--accent-light);
                border: 1px solid rgba(99, 102, 241, 0.3);
            }

            .phase-indicator {
                display: flex;
                justify-content: center;
                gap: 10px;
                margin-top: 10px;
            }

            .phase {
                padding: 5px 10px;
                border-radius: 5px;
                background: rgba(99, 102, 241, 0.2);
                color: var(--text-secondary);
            }

            .phase.active {
                background: var(--accent);
                color: white;
            }

            .log-entry {
                margin: 5px 0;
                padding: 5px;
                background: rgba(0, 0, 0, 0.2);
                border-radius: 4px;
                font-size: 12px;
            }

            .log-container {
                position: absolute;
                top: 10px;
                right: 10px;
                width: 200px;
                max-height: 120px;
                overflow-y: auto;
                background: rgba(0, 0, 0, 0.4);
                border-radius: 8px;
                padding: 10px;
                font-size: 12px;
                font-family: "Roboto Mono", monospace;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <!-- Header -->
            <header>
                <div class="logo">
                    <div class="logo-icon floating">
                        <i class="fas fa-fire"></i>
                    </div>
                    <div class="logo-text">
                        <h1>AlgoViz Hub</h1>
                        <p>ALGORITHM VISUALIZATION REPOSITORY</p>
                        <div class="breadcrumb">
                            <a href="#"><i class="fas fa-home"></i> Home</a> >
                            <a href="#">Consensus Algorithms</a> >
                            <span>HotStuff</span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Algorithm Header -->
            <div class="algorithm-header">
                <h1>HotStuff Consensus</h1>
                <div class="category">
                    <i class="fas fa-bolt"></i> Byzantine Fault-Tolerant
                    Protocol
                </div>
                <div class="complexity-badge">Latency: 3 View Changes</div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Left Column: Algorithm Details -->
                <div class="left-column">
                    <!-- Description Section -->
                    <div class="section">
                        <h2>
                            <i class="fas fa-file-alt"></i> Algorithm Overview
                        </h2>
                        <p>
                            HotStuff is a leader-based Byzantine fault-tolerant
                            (BFT) consensus protocol that provides linear
                            communication complexity per leader. It introduces
                            the concept of a "chained" consensus mechanism where
                            each block contains a cryptographic hash of the
                            previous block.
                        </p>
                        <p>
                            The protocol operates in views with rotating leaders
                            and achieves consensus through a three-phase voting
                            process: prepare, pre-commit, and commit. HotStuff
                            is known for its simplicity, efficiency, and being
                            the foundation for Facebook's Libra blockchain.
                        </p>

                        <div class="key-points">
                            <div class="point-card">
                                <h3>
                                    <i class="fas fa-check-circle"></i> Key
                                    Feature
                                </h3>
                                <p>
                                    Linear message complexity per leader with
                                    threshold signatures
                                </p>
                            </div>
                            <div class="point-card">
                                <h3><i class="fas fa-bolt"></i> Performance</h3>
                                <p>
                                    Optimized for low latency with just three
                                    communication steps
                                </p>
                            </div>
                            <div class="point-card">
                                <h3>
                                    <i class="fas fa-memory"></i> Fault
                                    Tolerance
                                </h3>
                                <p>
                                    Tolerates up to f Byzantine faults with 3f+1
                                    replicas
                                </p>
                            </div>
                            <div class="point-card">
                                <h3>
                                    <i class="fas fa-project-diagram"></i>
                                    Architecture
                                </h3>
                                <p>
                                    Leader rotation with pipelined block
                                    processing
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Visualization Console -->
                    <div class="section">
                        <h2>
                            <i class="fas fa-laptop-code"></i> Interactive
                            Visualization
                        </h2>
                        <p>
                            The visualization below demonstrates the HotStuff
                            consensus algorithm in action. You can see the
                            leader rotation, three-phase voting process, and how
                            the system maintains consensus during failures. Use
                            the controls to simulate different scenarios.
                        </p>

                        <div class="visualization-console">
                            <div class="console-header">
                                <h3>
                                    <i class="fas fa-network-wired"></i>
                                    HotStuff Protocol Visualization
                                </h3>
                                <div class="console-controls">
                                    <button
                                        class="console-btn secondary"
                                        id="step-btn"
                                    >
                                        <i class="fas fa-step-forward"></i> Step
                                    </button>
                                    <button class="console-btn" id="run-btn">
                                        <i class="fas fa-play"></i> Run
                                    </button>
                                    <button
                                        class="console-btn secondary"
                                        id="reset-btn"
                                    >
                                        <i class="fas fa-redo"></i> Reset
                                    </button>
                                </div>
                            </div>

                            <div
                                class="visualization-area"
                                id="hotstuff-visualization"
                            >
                                <!-- Visualization will be rendered here by JavaScript -->
                                <div
                                    class="cluster"
                                    id="cluster-container"
                                ></div>
                            </div>

                            <div class="console-input">
                                <button class="console-btn" id="byzantine-btn">
                                    <i class="fas fa-user-secret"></i> Toggle
                                    Byzantine Node
                                </button>
                                <button class="console-btn" id="add-client-btn">
                                    <i class="fas fa-plus"></i> Add Transaction
                                </button>
                                <button
                                    class="console-btn secondary"
                                    id="fail-leader-btn"
                                >
                                    <i class="fas fa-crown"></i> Fail Leader
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Algorithm Steps -->
                    <div class="section">
                        <h2><i class="fas fa-list-ol"></i> Protocol Phases</h2>
                        <p>
                            The HotStuff consensus protocol operates through
                            these key phases:
                        </p>

                        <div class="key-points">
                            <div class="point-card">
                                <h3>
                                    <i class="fas fa-paper-plane"></i> 1.
                                    Propose
                                </h3>
                                <p>
                                    The leader proposes a new block containing
                                    transactions. The block includes the hash of
                                    the previous block to form a chain.
                                </p>
                            </div>
                            <div class="point-card">
                                <h3>
                                    <i class="fas fa-check-circle"></i> 2.
                                    Prepare
                                </h3>
                                <p>
                                    Replicas validate the proposed block and
                                    send a PREPARE vote to the leader. The
                                    leader collects 2f+1 votes to proceed.
                                </p>
                            </div>
                            <div class="point-card">
                                <h3>
                                    <i class="fas fa-lock"></i> 3. Pre-commit
                                </h3>
                                <p>
                                    The leader sends a PRE-COMMIT message.
                                    Replicas vote again after ensuring enough
                                    PREPARE votes exist. Requires 2f+1 votes.
                                </p>
                            </div>
                            <div class="point-card">
                                <h3>
                                    <i class="fas fa-check-double"></i> 4.
                                    Commit
                                </h3>
                                <p>
                                    The leader sends a COMMIT message. Replicas
                                    vote after ensuring enough PRE-COMMIT votes
                                    exist. Requires 2f+1 votes.
                                </p>
                            </div>
                            <div class="point-card">
                                <h3>
                                    <i class="fas fa-flag-checkered"></i> 5.
                                    Decide
                                </h3>
                                <p>
                                    The leader collects COMMIT votes and sends a
                                    DECIDE message. Replicas execute the block
                                    and update their state.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Pseudocode Section -->
                    <div class="section">
                        <h2><i class="fas fa-list-ol"></i> Pseudocode</h2>
                        <div class="code-block">
                            <pre><code>// Leader Protocol
function proposeBlock(block):
  send PROPOSAL(block) to all replicas
  wait for 2f+1 PREPARE votes
  send PRE-COMMIT(block) to all replicas
  wait for 2f+1 PRE-COMMIT votes
  send COMMIT(block) to all replicas
  wait for 2f+1 COMMIT votes
  send DECIDE(block) to all replicas

// Replica Protocol
on receive PROPOSAL(block) from leader:
  if validProposal(block):
    send VOTE(PREPARE, block) to leader

on receive PRE-COMMIT(block) from leader:
  if received 2f+1 PREPARE votes for block:
    send VOTE(PRE-COMMIT, block) to leader

on receive COMMIT(block) from leader:
  if received 2f+1 PRE-COMMIT votes for block:
    send VOTE(COMMIT, block) to leader

on receive DECIDE(block) from leader:
  if received 2f+1 COMMIT votes for block:
    executeBlock(block)
    updateHighQC(block.qc) // Update highest quorum certificate</code></pre>
                        </div>
                    </div>

                    <!-- Implementation Section -->
                    <div class="section">
                        <h2><i class="fas fa-code"></i> Implementation</h2>
                        <p>
                            Below is a simplified Python implementation of the
                            HotStuff consensus algorithm. This example
                            demonstrates the core consensus mechanism with
                            leader rotation and voting.
                        </p>

                        <div class="code-block">
                            <div class="code-header">
                                <span>Python Implementation</span>
                                <button class="copy-btn">
                                    <i class="fas fa-copy"></i> Copy Code
                                </button>
                            </div>
                            <pre><code><span class="keyword">import</span> time
<span class="keyword">import</span> hashlib
<span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict
<span class="keyword">from</span> typing <span class="keyword">import</span> List, Dict

<span class="keyword">class</span> <span class="function">Block</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>, parent_hash: str, transactions: List[str], view: int):
        <span class="keyword">self</span>.parent_hash = parent_hash
        <span class="keyword">self</span>.transactions = transactions
        <span class="keyword">self</span>.view = view
        <span class="keyword">self</span>.hash = self.calculate_hash()

    <span class="keyword">def</span> <span class="function">calculate_hash</span>(<span class="keyword">self</span>) -> str:
        block_data = f<span class="string">"{self.parent_hash}{''.join(self.transactions)}{self.view}"</span>
        <span class="keyword">return</span> hashlib.sha256(block_data.encode()).hexdigest()

<span class="keyword">class</span> <span class="function">Replica</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>, node_id: int, n: int, f: int):
        <span class="keyword">self</span>.node_id = node_id
        <span class="keyword">self</span>.n = n  <span class="comment"># Total nodes</span>
        <span class="keyword">self</span>.f = f  <span class="comment"># Tolerated faults</span>
        <span class="keyword">self</span>.current_view = 0
        <span class="keyword">self</span>.leader = self.current_view % n
        <span class="keyword">self</span>.blockchain = []
        <span class="keyword">self</span>.votes = defaultdict(dict)  <span class="comment"># phase -> block_hash -> votes</span>
        <span class="keyword">self</span>.high_qc = <span class="keyword">None</span>  <span class="comment"># Highest quorum certificate</span>

    <span class="keyword">def</span> <span class="function">is_leader</span>(<span class="keyword">self</span>) -> bool:
        <span class="keyword">return</span> self.node_id == self.leader

    <span class="keyword">def</span> <span class="function">receive_proposal</span>(<span class="keyword">self</span>, block: Block):
        <span class="keyword">if</span> <span class="keyword">not</span> self.is_leader <span class="keyword">and</span> self.validate_block(block):
            self.send_vote(<span class="string">"PREPARE"</span>, block)

    <span class="keyword">def</span> <span class="function">receive_pre_commit</span>(<span class="keyword">self</span>, block: Block):
        prepare_votes = self.votes[<span class="string">"PREPARE"</span>].get(block.hash, [])
        <span class="keyword">if</span> len(prepare_votes) >= 2*self.f + 1:
            self.send_vote(<span class="string">"PRE-COMMIT"</span>, block)

    <span class="keyword">def</span> <span class="function">receive_commit</span>(<span class="keyword">self</span>, block: Block):
        pre_commit_votes = self.votes[<span class="string">"PRE-COMMIT"</span>].get(block.hash, [])
        <span class="keyword">if</span> len(pre_commit_votes) >= 2*self.f + 1:
            self.send_vote(<span class="string">"COMMIT"</span>, block)

    <span class="keyword">def</span> <span class="function">receive_decide</span>(<span class="keyword">self</span>, block: Block):
        commit_votes = self.votes[<span class="string">"COMMIT"</span>].get(block.hash, [])
        <span class="keyword">if</span> len(commit_votes) >= 2*self.f + 1:
            self.commit_block(block)

    <span class="keyword">def</span> <span class="function">send_vote</span>(<span class="keyword">self</span>, phase: str, block: Block):
        <span class="comment"># In real implementation, this would send to leader</span>
        <span class="keyword">if</span> block.hash <span class="keyword">not</span> <span class="keyword">in</span> self.votes[phase]:
            self.votes[phase][block.hash] = []
        self.votes[phase][block.hash].append(self.node_id)

    <span class="keyword">def</span> <span class="function">validate_block</span>(<span class="keyword">self</span>, block: Block) -> bool:
        <span class="comment"># Simplified validation logic</span>
        <span class="keyword">return</span> block.parent_hash == self.get_last_block_hash()

    <span class="keyword">def</span> <span class="function">get_last_block_hash</span>(<span class="keyword">self</span>) -> str:
        <span class="keyword">return</span> self.blockchain[-1].hash <span class="keyword">if</span> self.blockchain <span class="keyword">else</span> <span class="string">"genesis"</span>

    <span class="keyword">def</span> <span class="function">commit_block</span>(<span class="keyword">self</span>, block: Block):
        self.blockchain.append(block)
        self.high_qc = block.hash
        print(f<span class="string">"Node {self.node_id} committed block: {block.hash}"</span>)

    <span class="keyword">def</span> <span class="function">start_new_view</span>(<span class="keyword">self</span>):
        self.current_view += 1
        self.leader = self.current_view % self.n
        print(f<span class="string">"View changed to {self.current_view}. New leader: {self.leader}"</span>)

<span class="comment"># Example usage</span>
n = 4  <span class="comment"># Total nodes</span>
f = 1  <span class="comment"># Tolerated faults</span>
replicas = [Replica(i, n, f) <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]

<span class="comment"># Simulate a proposal from leader</span>
leader = replicas[0]
block = Block(<span class="string">"genesis"</span>, [<span class="string">"tx1"</span>, <span class="string">"tx2"</span>], 0)
<span class="keyword">for</span> replica <span class="keyword">in</span> replicas:
    <span class="keyword">if</span> replica.node_id != leader.node_id:
        replica.receive_proposal(block)</code></pre>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Additional Info -->
                <div class="right-column">
                    <!-- Properties Section -->
                    <div class="section">
                        <h2>
                            <i class="fas fa-info-circle"></i> Protocol
                            Properties
                        </h2>
                        <div class="properties-grid">
                            <div class="property-card">
                                <h4>Category</h4>
                                <div class="value">BFT Consensus</div>
                            </div>
                            <div class="property-card">
                                <h4>Fault Model</h4>
                                <div class="value">Byzantine</div>
                            </div>
                            <div class="property-card">
                                <h4>Fault Tolerance</h4>
                                <div class="value">f failures</div>
                            </div>
                            <div class="property-card">
                                <h4>Replica Count</h4>
                                <div class="value">3f+1</div>
                            </div>
                            <div class="property-card">
                                <h4>Latency</h4>
                                <div class="value">3 RTTs</div>
                            </div>
                            <div class="property-card">
                                <h4>Message Complexity</h4>
                                <div class="value">O(n)</div>
                            </div>
                            <div class="property-card">
                                <h4>Leader Rotation</h4>
                                <div class="value">Per View</div>
                            </div>
                            <div class="property-card">
                                <h4>Deployment</h4>
                                <div class="value">Libra Blockchain</div>
                            </div>
                        </div>
                    </div>

                    <!-- Applications Section -->
                    <div class="section">
                        <h2><i class="fas fa-lightbulb"></i> Applications</h2>
                        <p>
                            HotStuff is used in various blockchain and
                            distributed systems:
                        </p>
                        <ul
                            style="
                                padding-left: 20px;
                                margin: 15px 0;
                                color: var(--text-secondary);
                            "
                        >
                            <li style="margin-bottom: 10px">
                                Facebook's Libra blockchain (now Diem)
                            </li>
                            <li style="margin-bottom: 10px">
                                Permissioned blockchain networks
                            </li>
                            <li style="margin-bottom: 10px">
                                Enterprise BFT systems
                            </li>
                            <li style="margin-bottom: 10px">
                                Financial settlement systems
                            </li>
                            <li>Supply chain management</li>
                        </ul>
                    </div>

                    <!-- Advantages Section -->
                    <div class="section">
                        <h2><i class="fas fa-star"></i> Key Advantages</h2>
                        <ul
                            style="
                                padding-left: 20px;
                                margin: 15px 0;
                                color: var(--text-secondary);
                            "
                        >
                            <li style="margin-bottom: 10px">
                                <strong>Linear Communication:</strong> O(n)
                                messages per decision
                            </li>
                            <li style="margin-bottom: 10px">
                                <strong>Optimistic Responsiveness:</strong>
                                Progress at network speed
                            </li>
                            <li style="margin-bottom: 10px">
                                <strong>Leader Rotation:</strong> Automatic
                                leader change per view
                            </li>
                            <li style="margin-bottom: 10px">
                                <strong>Pipelining:</strong> Concurrent
                                processing of blocks
                            </li>
                            <li>
                                <strong>Simplicity:</strong> Easier to implement
                                than PBFT
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <footer>
                <div class="footer-links">
                    <a href="#"
                        ><i class="fa-brands fa-linkedin"></i> LinkedIN</a
                    >
                    <a href="#"><i class="fa-solid fa-at"></i> E-Mail</a>
                    <a href="#"
                        ><i class="fa-solid fa-mug-hot"></i> Buy Me a Coffee</a
                    >
                </div>
                <p>
                    AlgoViz Hub - Interactive Algorithm Visualization Platform
                </p>
                <p>&copy; 2025 AlgoViz Hub. All rights reserved.</p>
            </footer>
        </div>

        <script>
            // Visualization for HotStuff Consensus Algorithm
            document.addEventListener("DOMContentLoaded", function () {
                const visualization = document.getElementById(
                    "hotstuff-visualization",
                );
                const clusterContainer =
                    document.getElementById("cluster-container");
                const runBtn = document.getElementById("run-btn");
                const stepBtn = document.getElementById("step-btn");
                const resetBtn = document.getElementById("reset-btn");
                const byzantineBtn = document.getElementById("byzantine-btn");
                const addClientBtn = document.getElementById("add-client-btn");
                const failLeaderBtn =
                    document.getElementById("fail-leader-btn");

                // State variables
                let simulationRunning = false;
                let simulationInterval;
                let currentPhase = 0;
                let nodes = [];
                let clients = [];
                let messages = [];
                let leaderNode = null;
                let byzantineNode = null;
                let currentBlock = null;

                // Initialize visualization
                function initVisualization() {
                    clusterContainer.innerHTML = "";
                    nodes = [];
                    clients = [];
                    messages = [];
                    leaderNode = null;
                    byzantineNode = null;
                    currentBlock = null;
                    currentPhase = 0;

                    // Create nodes
                    const positions = [
                        { x: 50, y: 150 }, // Leader position
                        { x: 250, y: 50 },
                        { x: 250, y: 250 },
                        { x: 450, y: 150 },
                    ];

                    for (let i = 0; i < 4; i++) {
                        const node = document.createElement("div");
                        node.className = "node";
                        node.id = `node-${i}`;
                        node.textContent = `N${i}`;
                        node.style.left = `${positions[i].x}px`;
                        node.style.top = `${positions[i].y}px`;
                        clusterContainer.appendChild(node);

                        const nodeData = {
                            id: i,
                            element: node,
                            isLeader: false,
                            votes: { prepare: 0, precommit: 0, commit: 0 },
                        };

                        nodes.push(nodeData);

                        // Set node 0 as initial leader
                        if (i === 0) {
                            nodeData.isLeader = true;
                            node.classList.add("leader");
                            leaderNode = nodeData;
                        }
                    }

                    // Create log container
                    const logContainer = document.createElement("div");
                    logContainer.className = "log-container";
                    logContainer.id = "log-container";
                    clusterContainer.appendChild(logContainer);

                    // Create status panel
                    const statusPanel = document.createElement("div");
                    statusPanel.className = "status-panel";
                    statusPanel.id = "status-panel";
                    statusPanel.innerHTML = "System Status: Initializing";

                    const phaseIndicator = document.createElement("div");
                    phaseIndicator.className = "phase-indicator";
                    phaseIndicator.innerHTML = `
            <div class="phase">Propose</div>
            <div class="phase">Prepare</div>
            <div class="phase">Pre-Commit</div>
            <div class="phase">Commit</div>
            <div class="phase">Decide</div>
          `;
                    statusPanel.appendChild(phaseIndicator);
                    clusterContainer.appendChild(statusPanel);

                    // Start simulation
                    setTimeout(startConsensus, 1000);
                }

                // Start consensus process
                function startConsensus() {
                    logEvent("Starting new consensus round");
                    updateStatus("Leader proposing new block");
                    highlightPhase(0);

                    // Create a new block
                    currentBlock = {
                        id: Date.now(),
                        transactions: ["Tx" + Math.floor(Math.random() * 1000)],
                    };

                    // Leader proposes block
                    setTimeout(() => {
                        logEvent(
                            `Leader N${leaderNode.id} proposed block: ${currentBlock.id}`,
                        );
                        sendMessage(leaderNode, "PROPOSAL", "New Block", nodes);

                        // Move to prepare phase
                        setTimeout(startPreparePhase, 1000);
                    }, 500);
                }

                // Start prepare phase
                function startPreparePhase() {
                    currentPhase = 1;
                    highlightPhase(1);
                    updateStatus("Prepare Phase: Replicas voting");

                    // Replicas send prepare votes
                    nodes
                        .filter((node) => !node.isLeader)
                        .forEach((node) => {
                            // Byzantine node might not vote
                            if (node === byzantineNode && Math.random() > 0.5) {
                                logEvent(
                                    `Byzantine node N${node.id} not voting`,
                                );
                                return;
                            }

                            setTimeout(() => {
                                logEvent(`Node N${node.id} sent PREPARE vote`);
                                sendMessage(node, "PREPARE", "Vote", [
                                    leaderNode,
                                ]);
                                node.votes.prepare++;
                            }, 300 * node.id);
                        });

                    // Leader collects votes
                    setTimeout(() => {
                        const prepareVotes = nodes
                            .filter((n) => n !== leaderNode)
                            .reduce((sum, node) => sum + node.votes.prepare, 0);
                        if (prepareVotes >= 2) {
                            // 2f+1 = 3 for f=1, but we have only 3 replicas
                            logEvent(
                                `Leader collected ${prepareVotes} PREPARE votes`,
                            );
                            startPreCommitPhase();
                        } else {
                            logEvent(
                                `Not enough PREPARE votes (${prepareVotes}/2)`,
                            );
                            updateStatus("Waiting for more PREPARE votes");
                            // Retry or change view
                            setTimeout(startPreCommitPhase, 2000);
                        }
                    }, 2000);
                }

                // Start pre-commit phase
                function startPreCommitPhase() {
                    currentPhase = 2;
                    highlightPhase(2);
                    updateStatus("Pre-Commit Phase: Leader broadcasting");

                    // Leader sends pre-commit message
                    setTimeout(() => {
                        logEvent(`Leader N${leaderNode.id} sent PRE-COMMIT`);
                        sendMessage(
                            leaderNode,
                            "PRE-COMMIT",
                            "Pre-Commit",
                            nodes,
                        );

                        // Replicas send pre-commit votes
                        setTimeout(() => {
                            nodes
                                .filter((node) => !node.isLeader)
                                .forEach((node) => {
                                    // Byzantine node might not vote
                                    if (
                                        node === byzantineNode &&
                                        Math.random() > 0.5
                                    ) {
                                        logEvent(
                                            `Byzantine node N${node.id} not voting`,
                                        );
                                        return;
                                    }

                                    setTimeout(() => {
                                        logEvent(
                                            `Node N${node.id} sent PRE-COMMIT vote`,
                                        );
                                        sendMessage(
                                            node,
                                            "PRE-COMMIT-VOTE",
                                            "Vote",
                                            [leaderNode],
                                        );
                                        node.votes.precommit++;
                                    }, 300 * node.id);
                                });

                            // Leader collects votes
                            setTimeout(() => {
                                const precommitVotes = nodes
                                    .filter((n) => n !== leaderNode)
                                    .reduce(
                                        (sum, node) =>
                                            sum + node.votes.precommit,
                                        0,
                                    );
                                if (precommitVotes >= 2) {
                                    logEvent(
                                        `Leader collected ${precommitVotes} PRE-COMMIT votes`,
                                    );
                                    startCommitPhase();
                                } else {
                                    logEvent(
                                        `Not enough PRE-COMMIT votes (${precommitVotes}/2)`,
                                    );
                                    updateStatus(
                                        "Waiting for more PRE-COMMIT votes",
                                    );
                                    // Retry or change view
                                    setTimeout(startCommitPhase, 2000);
                                }
                            }, 2000);
                        }, 500);
                    }, 500);
                }

                // Start commit phase
                function startCommitPhase() {
                    currentPhase = 3;
                    highlightPhase(3);
                    updateStatus("Commit Phase: Leader broadcasting");

                    // Leader sends commit message
                    setTimeout(() => {
                        logEvent(`Leader N${leaderNode.id} sent COMMIT`);
                        sendMessage(leaderNode, "COMMIT", "Commit", nodes);

                        // Replicas send commit votes
                        setTimeout(() => {
                            nodes
                                .filter((node) => !node.isLeader)
                                .forEach((node) => {
                                    // Byzantine node might not vote
                                    if (
                                        node === byzantineNode &&
                                        Math.random() > 0.5
                                    ) {
                                        logEvent(
                                            `Byzantine node N${node.id} not voting`,
                                        );
                                        return;
                                    }

                                    setTimeout(() => {
                                        logEvent(
                                            `Node N${node.id} sent COMMIT vote`,
                                        );
                                        sendMessage(
                                            node,
                                            "COMMIT-VOTE",
                                            "Vote",
                                            [leaderNode],
                                        );
                                        node.votes.commit++;
                                    }, 300 * node.id);
                                });

                            // Leader collects votes
                            setTimeout(() => {
                                const commitVotes = nodes
                                    .filter((n) => n !== leaderNode)
                                    .reduce(
                                        (sum, node) => sum + node.votes.commit,
                                        0,
                                    );
                                if (commitVotes >= 2) {
                                    logEvent(
                                        `Leader collected ${commitVotes} COMMIT votes`,
                                    );
                                    startDecidePhase();
                                } else {
                                    logEvent(
                                        `Not enough COMMIT votes (${commitVotes}/2)`,
                                    );
                                    updateStatus(
                                        "Waiting for more COMMIT votes",
                                    );
                                    // Retry or change view
                                    setTimeout(startDecidePhase, 2000);
                                }
                            }, 2000);
                        }, 500);
                    }, 500);
                }

                // Start decide phase
                function startDecidePhase() {
                    currentPhase = 4;
                    highlightPhase(4);
                    updateStatus("Decide Phase: Block committed");

                    // Leader sends decide message
                    setTimeout(() => {
                        logEvent(`Leader N${leaderNode.id} sent DECIDE`);
                        sendMessage(leaderNode, "DECIDE", "Decide", nodes);

                        // All nodes commit block
                        setTimeout(() => {
                            nodes.forEach((node) => {
                                node.element.style.backgroundColor =
                                    "var(--success)";
                                setTimeout(() => {
                                    node.element.style.backgroundColor =
                                        node.isLeader
                                            ? "var(--accent)"
                                            : "var(--secondary)";
                                    if (node === byzantineNode) {
                                        node.element.style.backgroundColor =
                                            "var(--danger)";
                                    }
                                }, 1000);
                            });

                            logEvent(
                                `Block ${currentBlock.id} committed by all nodes`,
                            );
                            updateStatus(`Block committed: ${currentBlock.id}`);

                            // Prepare for next round
                            setTimeout(() => {
                                rotateLeader();
                                setTimeout(startConsensus, 1000);
                            }, 2000);
                        }, 500);
                    }, 500);
                }

                // Rotate leader to next node
                function rotateLeader() {
                    // Remove leader status from current leader
                    if (leaderNode) {
                        leaderNode.isLeader = false;
                        leaderNode.element.classList.remove("leader");
                    }

                    // Select next leader (round-robin)
                    const currentLeaderIndex = nodes.findIndex(
                        (n) => n === leaderNode,
                    );
                    const nextLeaderIndex =
                        (currentLeaderIndex + 1) % nodes.length;
                    leaderNode = nodes[nextLeaderIndex];
                    leaderNode.isLeader = true;
                    leaderNode.element.classList.add("leader");

                    logEvent(`Leader rotated to Node ${leaderNode.id}`);
                    updateStatus(`New leader: Node ${leaderNode.id}`);
                }

                // Send a message from one node to others
                function sendMessage(sender, type, content, recipients) {
                    recipients.forEach((recipient) => {
                        if (sender === recipient) return;

                        const message = document.createElement("div");
                        message.className = "message";
                        message.textContent = type;

                        // Color code message types
                        if (type === "PROPOSAL")
                            message.style.backgroundColor = "var(--accent)";
                        else if (type.includes("PRE-COMMIT"))
                            message.style.backgroundColor = "var(--warning)";
                        else if (type.includes("COMMIT"))
                            message.style.backgroundColor = "var(--success)";
                        else if (type === "DECIDE")
                            message.style.backgroundColor = "#8b5cf6";
                        else
                            message.style.backgroundColor =
                                "var(--accent-light)";

                        message.style.left = `${sender.element.offsetLeft}px`;
                        message.style.top = `${sender.element.offsetTop}px`;
                        clusterContainer.appendChild(message);
                        messages.push(message);

                        setTimeout(() => {
                            message.classList.add("visible");
                            message.style.left = `${recipient.element.offsetLeft}px`;
                            message.style.top = `${recipient.element.offsetTop}px`;

                            // Remove message after delivery
                            setTimeout(() => {
                                message.remove();
                            }, 1000);
                        }, 100);
                    });
                }

                // Toggle byzantine node
                function toggleByzantineNode() {
                    if (!byzantineNode) {
                        // Select a random non-leader node
                        const candidates = nodes.filter(
                            (node) => !node.isLeader,
                        );
                        if (candidates.length === 0) return;

                        byzantineNode =
                            candidates[
                                Math.floor(Math.random() * candidates.length)
                            ];
                        byzantineNode.element.classList.add("byzantine");
                        logEvent(`Node ${byzantineNode.id} is now Byzantine!`);
                    } else {
                        byzantineNode.element.classList.remove("byzantine");
                        logEvent(
                            `Node ${byzantineNode.id} is no longer Byzantine`,
                        );
                        byzantineNode = null;
                    }
                }

                // Add client transaction
                function addClientTransaction() {
                    if (!currentBlock) return;

                    const newTransaction = `Tx${Math.floor(Math.random() * 1000)}`;
                    currentBlock.transactions.push(newTransaction);
                    logEvent(`Added new transaction: ${newTransaction}`);
                }

                // Fail current leader
                function failLeader() {
                    if (!leaderNode) return;

                    logEvent(`Leader Node ${leaderNode.id} failed!`);
                    leaderNode.element.style.backgroundColor = "var(--danger)";
                    leaderNode.element.style.borderColor = "var(--danger)";

                    // Rotate to new leader
                    setTimeout(() => {
                        rotateLeader();
                        setTimeout(startConsensus, 1000);
                    }, 1000);
                }

                // Log event to log container
                function logEvent(message) {
                    const logContainer =
                        document.getElementById("log-container");
                    const logEntry = document.createElement("div");
                    logEntry.className = "log-entry";
                    logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                    logContainer.appendChild(logEntry);

                    // Auto-scroll
                    logContainer.scrollTop = logContainer.scrollHeight;
                }

                // Update status panel
                function updateStatus(status) {
                    const statusPanel = document.getElementById("status-panel");
                    statusPanel.innerHTML = `System Status: ${status}`;

                    const phaseIndicator = document.createElement("div");
                    phaseIndicator.className = "phase-indicator";
                    phaseIndicator.innerHTML = `
            <div class="phase">Propose</div>
            <div class="phase">Prepare</div>
            <div class="phase">Pre-Commit</div>
            <div class="phase">Commit</div>
            <div class="phase">Decide</div>
          `;
                    statusPanel.appendChild(phaseIndicator);
                }

                // Highlight current phase
                function highlightPhase(index) {
                    const phases = document.querySelectorAll(".phase");
                    phases.forEach((phase, i) => {
                        if (i === index) {
                            phase.classList.add("active");
                        } else {
                            phase.classList.remove("active");
                        }
                    });
                }

                // Start simulation
                function startSimulation() {
                    if (simulationRunning) return;

                    simulationRunning = true;
                    runBtn.innerHTML = '<i class="fas fa-stop"></i> Stop';
                    runBtn.classList.add("secondary");

                    // Start periodic consensus rounds
                    simulationInterval = setInterval(() => {
                        if (leaderNode) {
                            startConsensus();
                        }
                    }, 8000);
                }

                // Stop simulation
                function stopSimulation() {
                    simulationRunning = false;
                    clearInterval(simulationInterval);
                    runBtn.innerHTML = '<i class="fas fa-play"></i> Run';
                    runBtn.classList.remove("secondary");
                }

                // Reset simulation
                function resetSimulation() {
                    stopSimulation();
                    initVisualization();
                }

                // Step through simulation
                function stepSimulation() {
                    if (!simulationRunning) {
                        startConsensus();
                    }
                }

                // Event listeners
                runBtn.addEventListener("click", () => {
                    if (simulationRunning) {
                        stopSimulation();
                    } else {
                        startSimulation();
                    }
                });

                stepBtn.addEventListener("click", stepSimulation);
                resetBtn.addEventListener("click", resetSimulation);
                byzantineBtn.addEventListener("click", toggleByzantineNode);
                addClientBtn.addEventListener("click", addClientTransaction);
                failLeaderBtn.addEventListener("click", failLeader);

                // Initialize the visualization
                initVisualization();

                // Copy button functionality
                document
                    .querySelector(".copy-btn")
                    .addEventListener("click", function () {
                        const code =
                            document.querySelector(
                                ".code-block code",
                            ).innerText;
                        navigator.clipboard.writeText(code);

                        const originalText = this.innerHTML;
                        this.innerHTML = '<i class="fas fa-check"></i> Copied!';

                        setTimeout(() => {
                            this.innerHTML = originalText;
                        }, 2000);
                    });
            });
        </script>
    </body>
</html>
