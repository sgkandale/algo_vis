<!DOCTYPE html>

<html lang="en">
<head><meta content="Study page replacement algorithms used in operating systems memory management" name="description"/><meta content="page replacement algorithm, fifo, lru, lfu, mru, nru, second chance" name="keywords"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>MRU Page Replacement Algorithm</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #1a1a2e, #16213e);
        color: #ecf0f1;
        min-height: 100vh;
        padding: 20px;
        line-height: 1.6;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        padding: 30px 0;
        margin-bottom: 20px;
      }

      h1 {
        font-size: 3.2rem;
        margin-bottom: 15px;
        background: linear-gradient(to right, #6a11cb, #2575fc);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .subtitle {
        font-size: 1.3rem;
        color: #bdc3c7;
        max-width: 800px;
        margin: 0 auto 25px;
      }

      .card {
        background: rgba(25, 40, 65, 0.8);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .card-title {
        font-size: 1.8rem;
        margin-bottom: 20px;
        color: #6a11cb;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .card-title i {
        background: linear-gradient(45deg, #6a11cb, #2575fc);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }

      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 25px;
        align-items: center;
      }

      .control-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
        flex: 1;
        min-width: 200px;
      }

      label {
        font-weight: 600;
        color: #2575fc;
      }

      input,
      select {
        padding: 12px 15px;
        border-radius: 8px;
        border: 2px solid #3a506b;
        background: rgba(30, 50, 80, 0.7);
        color: white;
        font-size: 1rem;
        transition: all 0.3s ease;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #6a11cb;
        box-shadow: 0 0 10px rgba(106, 17, 203, 0.5);
      }

      .btn {
        background: linear-gradient(45deg, #6a11cb, #2575fc);
        color: white;
        border: none;
        padding: 14px 25px;
        border-radius: 50px;
        cursor: pointer;
        font-size: 1.1rem;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 8px;
      }

      .btn:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
      }

      .btn:active {
        transform: translateY(2px);
      }

      .btn-outline {
        background: transparent;
        border: 2px solid #6a11cb;
        color: #6a11cb;
      }

      .btn-outline:hover {
        background: rgba(106, 17, 203, 0.15);
      }

      .visualization-container {
        display: flex;
        flex-direction: column;
        gap: 30px;
        margin-top: 20px;
      }

      .frames-container {
        display: flex;
        justify-content: center;
        gap: 25px;
        flex-wrap: wrap;
        margin: 20px 0;
      }

      .frame {
        width: 140px;
        height: 140px;
        border-radius: 12px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        border: 3px solid #3a506b;
        background: rgba(40, 65, 100, 0.8);
      }

      .frame::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.15),
          transparent
        );
      }

      .frame-label {
        position: absolute;
        top: 8px;
        left: 8px;
        font-size: 0.9rem;
        color: #2575fc;
      }

      .frame-content {
        font-size: 2.5rem;
        font-weight: bold;
        margin-top: 10px;
      }

      .frame-info {
        position: absolute;
        bottom: 8px;
        font-size: 0.9rem;
        color: #a0d2eb;
        text-align: center;
        width: 100%;
        padding: 0 5px;
      }

      .reference-string {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 15px;
        margin: 30px 0;
      }

      .ref-item {
        width: 60px;
        height: 60px;
        border-radius: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.5rem;
        font-weight: bold;
        background: rgba(40, 65, 100, 0.8);
        border: 2px solid #3a506b;
        transition: all 0.3s ease;
      }

      .ref-item.active {
        transform: scale(1.2);
        background: linear-gradient(45deg, #6a11cb, #2575fc);
        box-shadow: 0 0 20px rgba(106, 17, 203, 0.7);
        z-index: 10;
      }

      .ref-item.hit {
        background: linear-gradient(45deg, #2ecc71, #27ae60);
      }

      .ref-item.fault {
        background: linear-gradient(45deg, #e74c3c, #c0392b);
      }

      .stats-container {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 30px;
        margin: 30px 0;
      }

      .stat-card {
        background: rgba(40, 65, 100, 0.8);
        border-radius: 12px;
        padding: 20px;
        min-width: 200px;
        text-align: center;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      }

      .stat-value {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 10px 0;
        color: #6a11cb;
      }

      .stat-label {
        font-size: 1.1rem;
        color: #a0d2eb;
      }

      .history-container {
        margin-top: 20px;
      }

      .history-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }

      .history-table th {
        background: rgba(106, 17, 203, 0.3);
        padding: 12px;
        text-align: center;
      }

      .history-table td {
        padding: 12px;
        text-align: center;
        border-bottom: 1px solid #3a506b;
      }

      .history-table tr:nth-child(even) {
        background: rgba(30, 50, 80, 0.5);
      }

      .explanation {
        margin-top: 40px;
      }

      .explanation-content {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
        margin-top: 20px;
      }

      .explanation-card {
        background: rgba(40, 65, 100, 0.6);
        border-radius: 12px;
        padding: 20px;
      }

      .card-heading {
        font-size: 1.4rem;
        margin-bottom: 15px;
        color: #6a11cb;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      footer {
        text-align: center;
        padding: 30px 20px 20px;
        color: #7f8c8d;
        font-size: 1rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        margin-top: 20px;
      }

      .mru-container {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
        margin: 25px 0;
        min-height: 80px;
        background: rgba(30, 50, 80, 0.5);
        border-radius: 12px;
        padding: 20px;
      }

      .mru-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
      }

      .mru-page {
        width: 60px;
        height: 60px;
        border-radius: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.5rem;
        font-weight: bold;
        background: linear-gradient(45deg, #6a11cb, #2575fc);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .mru-label {
        font-size: 1rem;
        color: #2575fc;
        font-weight: bold;
      }

      /* Animation classes */
      .highlight {
        animation: highlight 1.5s ease;
      }

      @keyframes highlight {
        0% {
          box-shadow: 0 0 0 0 rgba(106, 17, 203, 0.7);
        }
        70% {
          box-shadow: 0 0 0 20px rgba(106, 17, 203, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(106, 17, 203, 0);
        }
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      .replaced {
        animation: replaced 0.5s ease;
      }

      @keyframes replaced {
        0% {
          background: #e74c3c;
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }

      .mru-highlight {
        animation: mruHighlight 1s ease;
      }

      @keyframes mruHighlight {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
          background: #00f2fe;
        }
        100% {
          transform: scale(1);
        }
      }

      @media (max-width: 768px) {
        h1 {
          font-size: 2.5rem;
        }

        .subtitle {
          font-size: 1.1rem;
        }

        .frame {
          width: 120px;
          height: 120px;
        }

        .ref-item {
          width: 50px;
          height: 50px;
        }

        .mru-page {
          width: 50px;
          height: 50px;
          font-size: 1.2rem;
        }
      }
    </style>
<meta content="MRU Page Replacement Algorithm" property="og:title"/><meta content="Study page replacement algorithms used in operating systems memory management" property="og:description"/><meta content="article" property="og:type"/><meta content="https://sgkandale.github.io/page_replacement_mru.html" property="og:url"/><meta content="AlgoViz Hub" property="og:site_name"/><meta content="summary" name="twitter:card"/><meta content="MRU Page Replacement Algorithm" name="twitter:title"/><meta content="Study page replacement algorithms used in operating systems memory management" name="twitter:description"/><meta content="@sgkandale" name="twitter:site"/><link href="https://sgkandale.github.io/page_replacement_mru.html" rel="canonical"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "MRU Page Replacement Algorithm",
  "description": "Study page replacement algorithms used in operating systems memory management",
  "author": {
    "@type": "Person",
    "name": "Shantanu Kandale"
  },
  "publisher": {
    "@type": "Organization",
    "name": "AlgoViz Hub",
    "logo": {
      "@type": "ImageObject",
      "url": "https://sgkandale.github.io/favicon.ico"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://sgkandale.github.io/page_replacement_mru.html"
  }
}</script></head>
<body>
<div class="container">
<header>
<h1>MRU Page Replacement Algorithm</h1>
<p class="subtitle">
          Visualization of the Most Recently Used (MRU) page replacement
          algorithm
        </p>
</header>
<section class="card">
<h2 class="card-title">
<i class="fas fa-sliders-h"></i> Simulation Controls
        </h2>
<div class="controls">
<div class="control-group">
<label for="referenceInput"><i class="fas fa-list-ol"></i> Reference String</label>
<input id="referenceInput" type="text" value="1,2,3,4,1,2,5,6,2,1,3,7"/>
</div>
<div class="control-group">
<label for="frameCount"><i class="fas fa-border-all"></i> Number of Frames</label>
<select id="frameCount">
<option selected="" value="3">3 Frames</option>
<option value="4">4 Frames</option>
<option value="5">5 Frames</option>
</select>
</div>
<div class="control-group">
<label for="speedControl"><i class="fas fa-tachometer-alt"></i> Animation Speed</label>
<select id="speedControl">
<option value="1500">Slow</option>
<option selected="" value="1000">Medium</option>
<option value="500">Fast</option>
</select>
</div>
<div class="control-group">
<button class="btn" id="startBtn">
<i class="fas fa-play"></i> Start Simulation
            </button>
<button class="btn btn-outline" id="resetBtn">
<i class="fas fa-undo"></i> Reset
            </button>
</div>
</div>
<div class="controls">
<button class="btn" id="prevBtn">
<i class="fas fa-step-backward"></i> Previous
          </button>
<button class="btn" id="nextBtn">
<i class="fas fa-step-forward"></i> Next
          </button>
<button class="btn" id="autoBtn">
<i class="fas fa-sync-alt"></i> Auto Run
          </button>
</div>
</section>
<section class="card">
<h2 class="card-title"><i class="fas fa-tv"></i> Visualization</h2>
<div class="visualization-container">
<h3><i class="fas fa-list"></i> Reference String</h3>
<div class="reference-string" id="refStringContainer">
<!-- Reference items will be generated here -->
</div>
<h3><i class="fas fa-memory"></i> Page Frames</h3>
<div class="frames-container" id="framesContainer">
<!-- Page frames will be generated here -->
</div>
<h3><i class="fas fa-star"></i> Most Recently Used</h3>
<div class="mru-container" id="mruContainer">
<!-- MRU items will be generated here -->
</div>
<h3><i class="fas fa-chart-line"></i> Statistics</h3>
<div class="stats-container">
<div class="stat-card">
<div class="stat-label">Page Faults</div>
<div class="stat-value" id="faultCount">0</div>
<div>Misses when page not in memory</div>
</div>
<div class="stat-card">
<div class="stat-label">Page Hits</div>
<div class="stat-value" id="hitCount">0</div>
<div>Successes when page found</div>
</div>
<div class="stat-card">
<div class="stat-label">Fault Rate</div>
<div class="stat-value" id="faultRate">0%</div>
<div>Faults / Total References</div>
</div>
</div>
<div class="history-container">
<h3><i class="fas fa-history"></i> Replacement History</h3>
<table class="history-table">
<thead>
<tr>
<th>Step</th>
<th>Page</th>
<th>Status</th>
<th>Frames</th>
<th>Replaced</th>
<th>MRU Page</th>
</tr>
</thead>
<tbody id="historyBody">
<!-- History rows will be added here -->
</tbody>
</table>
</div>
</div>
</section>
<section class="card explanation">
<h2 class="card-title">
<i class="fas fa-lightbulb"></i> How MRU Works
        </h2>
<div class="explanation-content">
<div class="explanation-card">
<h3 class="card-heading"><i class="fas fa-1"></i> Concept</h3>
<p>
              The Most Recently Used (MRU) page replacement algorithm replaces
              the page that has been used most recently.
            </p>
<p>
              Unlike LRU, MRU assumes that the most recently used page might not
              be needed again in the near future.
            </p>
</div>
<div class="explanation-card">
<h3 class="card-heading">
<i class="fas fa-2"></i> Implementation
            </h3>
<p>MRU can be implemented using:</p>
<ul>
<li>A stack or list to track the order of page usage</li>
<li>A timestamp for each page's last access</li>
<li>Special hardware support for access tracking</li>
</ul>
<p>
              When a page needs to be replaced, the most recently accessed page
              is selected.
            </p>
</div>
<div class="explanation-card">
<h3 class="card-heading"><i class="fas fa-3"></i> Advantages</h3>
<ul>
<li>Effective for workloads with sequential access patterns</li>
<li>
                Performs well when recently used pages are unlikely to be reused
              </li>
<li>Simple to implement with stack-based approach</li>
<li>Useful in certain database scenarios</li>
</ul>
</div>
<div class="explanation-card">
<h3 class="card-heading"><i class="fas fa-4"></i> Disadvantages</h3>
<ul>
<li>Poor performance for most common access patterns</li>
<li>Can remove frequently used pages if recently accessed</li>
<li>Not commonly used in general-purpose systems</li>
<li>Susceptible to Belady's Anomaly</li>
</ul>
</div>
</div>
</section>
<footer>
<p>
          MRU Page Replacement Algorithm Visualization | Created for Educational
          Purposes
        </p>
<p>
          Note: This visualization demonstrates the algorithm behavior and does
          not interact with actual system memory
        </p>
</footer>
</div>
<script>
      document.addEventListener("DOMContentLoaded", function () {
        // DOM elements
        const refInput = document.getElementById("referenceInput");
        const frameCount = document.getElementById("frameCount");
        const speedControl = document.getElementById("speedControl");
        const startBtn = document.getElementById("startBtn");
        const resetBtn = document.getElementById("resetBtn");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const autoBtn = document.getElementById("autoBtn");
        const refStringContainer =
          document.getElementById("refStringContainer");
        const framesContainer = document.getElementById("framesContainer");
        const mruContainer = document.getElementById("mruContainer");
        const faultCount = document.getElementById("faultCount");
        const hitCount = document.getElementById("hitCount");
        const faultRate = document.getElementById("faultRate");
        const historyBody = document.getElementById("historyBody");

        // Algorithm variables
        let referenceString = [];
        let frames = [];
        let lastUsed = {};
        let mruPage = null;
        let currentStep = 0;
        let pageFaults = 0;
        let pageHits = 0;
        let history = [];
        let animationInterval;

        // Initialize visualization
        function initializeVisualization() {
          // Parse reference string
          referenceString = refInput.value
            .split(",")
            .map((item) => item.trim());

          // Clear previous state
          frames = Array(parseInt(frameCount.value)).fill(null);
          lastUsed = {};
          mruPage = null;
          currentStep = 0;
          pageFaults = 0;
          pageHits = 0;
          history = [];

          // Update UI
          updateRefStringDisplay();
          createFrames();
          updateMruDisplay();
          updateStats();
          updateHistory();

          // Highlight first reference
          highlightCurrentStep();
        }

        // Create reference string display
        function updateRefStringDisplay() {
          refStringContainer.innerHTML = "";
          referenceString.forEach((ref, index) => {
            const refItem = document.createElement("div");
            refItem.className = "ref-item";
            refItem.textContent = ref;
            refItem.dataset.index = index;
            refStringContainer.appendChild(refItem);
          });
        }

        // Create frame elements
        function createFrames() {
          framesContainer.innerHTML = "";
          for (let i = 0; i < frames.length; i++) {
            const frame = document.createElement("div");
            frame.className = "frame";
            frame.dataset.index = i;

            const label = document.createElement("div");
            label.className = "frame-label";
            label.textContent = `Frame ${i + 1}`;

            const content = document.createElement("div");
            content.className = "frame-content";
            content.textContent = frames[i] || "-";

            const info = document.createElement("div");
            info.className = "frame-info";
            if (frames[i]) {
              info.textContent = `Last Used: ${lastUsed[frames[i]] || "-"}`;
            } else {
              info.textContent = "Last Used: -";
            }

            frame.appendChild(label);
            frame.appendChild(content);
            frame.appendChild(info);
            framesContainer.appendChild(frame);
          }
        }

        // Update frame display
        function updateFrames() {
          const frameElements = framesContainer.querySelectorAll(".frame");
          frameElements.forEach((frameEl, index) => {
            const content = frameEl.querySelector(".frame-content");
            const info = frameEl.querySelector(".frame-info");

            content.textContent = frames[index] || "-";

            if (frames[index]) {
              info.textContent = `Last Used: ${lastUsed[frames[index]] || "-"}`;
            } else {
              info.textContent = "Last Used: -";
            }
          });
        }

        // Update MRU display
        function updateMruDisplay() {
          mruContainer.innerHTML = "";

          if (mruPage) {
            const mruItem = document.createElement("div");
            mruItem.className = "mru-item";

            const pageEl = document.createElement("div");
            pageEl.className = "mru-page mru-highlight";
            pageEl.textContent = mruPage;

            const labelEl = document.createElement("div");
            labelEl.className = "mru-label";
            labelEl.textContent = "Most Recently Used";

            mruItem.appendChild(pageEl);
            mruItem.appendChild(labelEl);
            mruContainer.appendChild(mruItem);

            // Reset animation class after it runs
            setTimeout(() => {
              pageEl.classList.remove("mru-highlight");
            }, 1000);
          } else {
            mruContainer.innerHTML =
              '<div class="mru-label">No pages used yet</div>';
          }
        }

        // Update statistics
        function updateStats() {
          faultCount.textContent = pageFaults;
          hitCount.textContent = pageHits;

          const total = pageFaults + pageHits;
          const rate = total > 0 ? Math.round((pageFaults / total) * 100) : 0;
          faultRate.textContent = `${rate}%`;
        }

        // Update history table
        function updateHistory() {
          historyBody.innerHTML = "";
          history.forEach((entry, index) => {
            const row = document.createElement("tr");

            const stepCell = document.createElement("td");
            stepCell.textContent = index + 1;

            const pageCell = document.createElement("td");
            pageCell.textContent = entry.page;

            const statusCell = document.createElement("td");
            statusCell.textContent = entry.status;
            statusCell.style.color =
              entry.status === "Hit" ? "#2ecc71" : "#e74c3c";
            statusCell.style.fontWeight = "bold";

            const framesCell = document.createElement("td");
            framesCell.textContent = entry.frames.join(", ") || "Empty";

            const replacedCell = document.createElement("td");
            replacedCell.textContent = entry.replaced || "-";

            const mruCell = document.createElement("td");
            mruCell.textContent = entry.mru || "-";

            row.appendChild(stepCell);
            row.appendChild(pageCell);
            row.appendChild(statusCell);
            row.appendChild(framesCell);
            row.appendChild(replacedCell);
            row.appendChild(mruCell);

            historyBody.appendChild(row);
          });
        }

        // Highlight current step in reference string
        function highlightCurrentStep() {
          const refItems = refStringContainer.querySelectorAll(".ref-item");
          refItems.forEach((item, index) => {
            item.classList.remove("active", "hit", "fault");

            if (index === currentStep) {
              item.classList.add("active");
            }

            // Add hit/fault class for previous steps
            if (index < currentStep) {
              const historyEntry = history[index];
              if (historyEntry) {
                item.classList.add(
                  historyEntry.status === "Hit" ? "hit" : "fault"
                );
              }
            }
          });
        }

        // Process a step
        function processStep() {
          if (currentStep >= referenceString.length) return;

          const page = referenceString[currentStep];
          let status = "Hit";
          let replacedPage = null;

          // Check if page is already in a frame
          const pageIndex = frames.indexOf(page);

          if (pageIndex !== -1) {
            // Page is already in memory (hit)
            pageHits++;
            status = "Hit";

            // Update last used time
            lastUsed[page] = currentStep + 1;
            mruPage = page;
          } else {
            // Page fault
            pageFaults++;
            status = "Fault";

            // Check for empty frame
            const emptyIndex = frames.indexOf(null);

            if (emptyIndex !== -1) {
              // There's an empty frame
              frames[emptyIndex] = page;
              lastUsed[page] = currentStep + 1;
              mruPage = page;
            } else {
              // Find the most recently used page to replace
              let candidatePage = null;
              let candidateIndex = -1;
              let maxLastUsed = -1;

              for (let i = 0; i < frames.length; i++) {
                const framePage = frames[i];
                if (lastUsed[framePage] > maxLastUsed) {
                  maxLastUsed = lastUsed[framePage];
                  candidatePage = framePage;
                  candidateIndex = i;
                }
              }

              // Replace the candidate page
              replacedPage = candidatePage;
              frames[candidateIndex] = page;

              // Update last used for new page
              lastUsed[page] = currentStep + 1;
              mruPage = page;

              // Animate the replaced frame
              const frameToReplace = framesContainer.querySelector(
                `.frame[data-index="${candidateIndex}"]`
              );
              frameToReplace.classList.add("replaced");
              setTimeout(() => {
                frameToReplace.classList.remove("replaced");
              }, 500);
            }
          }

          // Add to history
          history.push({
            step: currentStep + 1,
            page: page,
            status: status,
            frames: [...frames],
            replaced: replacedPage,
            mru: mruPage,
          });

          // Update UI
          updateFrames();
          updateMruDisplay();
          updateStats();
          updateHistory();
          highlightCurrentStep();

          currentStep++;
        }

        // Start simulation
        function startSimulation() {
          clearInterval(animationInterval);
          const speed = parseInt(speedControl.value);

          // Reset if we're at the end
          if (currentStep >= referenceString.length) {
            initializeVisualization();
          }

          animationInterval = setInterval(() => {
            processStep();
            if (currentStep >= referenceString.length) {
              clearInterval(animationInterval);
            }
          }, speed);
        }

        // Initialize
        initializeVisualization();

        // Event listeners
        startBtn.addEventListener("click", function () {
          startSimulation();
        });

        resetBtn.addEventListener("click", function () {
          clearInterval(animationInterval);
          initializeVisualization();
        });

        prevBtn.addEventListener("click", function () {
          clearInterval(animationInterval);
          if (currentStep > 0) {
            // Move back one step
            currentStep--;
            const lastHistory = history.pop();

            // Reset stats
            pageFaults = history.filter(
              (entry) => entry.status === "Fault"
            ).length;
            pageHits = history.filter((entry) => entry.status === "Hit").length;

            if (history.length > 0) {
              const lastEntry = history[history.length - 1];
              frames = [...lastEntry.frames];
              mruPage = lastEntry.mru;

              // Rebuild lastUsed from history
              lastUsed = {};
              for (let i = 0; i <= currentStep; i++) {
                const page = referenceString[i];
                if (frames.includes(page)) {
                  lastUsed[page] = i + 1;
                }
              }
            } else {
              frames = Array(parseInt(frameCount.value)).fill(null);
              lastUsed = {};
              mruPage = null;
            }

            // Update UI
            updateFrames();
            updateMruDisplay();
            updateStats();
            updateHistory();
            highlightCurrentStep();
          }
        });

        nextBtn.addEventListener("click", function () {
          clearInterval(animationInterval);
          if (currentStep < referenceString.length) {
            processStep();
          }
        });

        autoBtn.addEventListener("click", function () {
          startSimulation();
        });

        frameCount.addEventListener("change", function () {
          initializeVisualization();
        });
      });
    </script>
</body>
</html>
